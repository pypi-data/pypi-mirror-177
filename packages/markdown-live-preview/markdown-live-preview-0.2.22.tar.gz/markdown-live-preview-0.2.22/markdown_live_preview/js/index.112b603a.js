const CYCLE=500,title=document.body.querySelector("#title"),display=document.body.querySelector("article"),api_request=async()=>await(await fetch(`${location.origin}/api/info`)).json(),ws_connect=async function*(){const t=`ws://${location.host}/ws`;let e=()=>{},o=new WebSocket(t);const a=()=>{o.onmessage=({data:t})=>e(t),o.onclose=async()=>{await new Promise((t=>setTimeout(t,500))),o=new WebSocket(t),a()}};for(a();;){const t=new Promise((t=>e=t));yield t}},update=async t=>{const e=await(await fetch(`${location.origin}/api/markdown`)).text();display.innerHTML=e,await new Promise((t=>requestAnimationFrame(t)));const o=document.body.querySelectorAll('[diff="True"]'),[a,...n]=o;t&&a&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},main=async()=>{const t=await api_request();document.title=t.title,title.textContent=t.title;await Promise.all([(async()=>{for(;;)try{for await(const e of ws_connect())await update(t.follow)}catch(t){console.error(t)}})(),(async()=>{let t;for(;;){try{const e=await api_request();e.sha!==t&&(await update(e.follow),t=e.sha)}catch(t){console.error(t)}await new Promise((t=>setTimeout(t,500)))}})()])};main();