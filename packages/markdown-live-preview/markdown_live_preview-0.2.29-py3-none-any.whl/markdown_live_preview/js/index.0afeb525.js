(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();const d=500,w=document.body.querySelector("#title"),m=document.body.querySelector("article"),s=document.createElement("template"),l="diff",y=function*(...n){const r=n.map(o=>o[Symbol.iterator]());for(;;){const o=r.map(e=>e.next());if(o.every(e=>e.done??!1))break;yield o.map(e=>e.value)}},f=async()=>await(await fetch(`${location.origin}/api/info`)).json(),b=async function*(){const n=`ws://${location.host}/ws`;let r=()=>{},o=new WebSocket(n);const e=()=>{o.onmessage=({data:t})=>r(t),o.onclose=async()=>{await new Promise(t=>setTimeout(t,d)),o=new WebSocket(n),e()}};for(e();;)yield new Promise(i=>r=i)},p=(n,r)=>{let o=!1;for(const[e,t]of y([...n.childNodes],[...r.childNodes]))if(e&&!t)o=!0,e.remove();else if(!e&&t)o=!0,n.appendChild(t);else if(e instanceof Element&&t instanceof Element)if(e.tagName!==t.tagName)e.replaceWith(t);else{const i=new Map(function*(){for(const{name:c,value:a}of t.attributes)yield[c,a]}());for(const{name:c}of e.attributes)i.has(c)||(c!==l&&(o=!0),e.removeAttribute(c));for(const[c,a]of i)e.getAttribute(c)!==a&&(o=!0,e.setAttribute(c,a));p(e,t)}else e.nodeType!==t.nodeType?(o=!0,n.replaceChild(t,e)):e.nodeValue!==t.nodeValue&&(o=!0,e.nodeValue=t.nodeValue);o&&n instanceof Element&&n!==m&&n.setAttribute(l,String(!0))},u=(n=>async(r,o)=>{if(o===n)return;n=o;const e=await(await fetch(`${location.origin}/api/markdown`)).text();s.innerHTML=e,s.normalize(),p(m,s.content),await new Promise(a=>requestAnimationFrame(a));const t=document.body.querySelectorAll(`[${l}="${!0}"]`),[i,...c]=t;r&&i&&i.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})(""),h=async()=>{const n=await f();document.title=n.title,w.textContent=n.title;const r=async()=>{for(;;)try{for await(const e of b())await u(n.follow,n.sha)}catch(e){console.error(e)}},o=async()=>{for(;;){try{const e=await f();await u(e.follow,e.sha)}catch(e){console.error(e)}await new Promise(e=>setTimeout(e,d))}};await Promise.all([r(),o()])};await h();
