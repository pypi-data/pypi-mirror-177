name: "Archive a single site"

on:
  workflow_dispatch:
    inputs:
      handle:
        description: 'Site handle'
        required: true
        type: string
      tweet:
        description: 'Tweet'
        required: true
        type: boolean
        default: false

jobs:
  archive-site:
    name: Archive site
    uses: palewire/news-homepages/.github/workflows/reusable-archive-single-site-workflow.yml@main
    with:
      handle: ${{ inputs.handle }}
    secrets: inherit

  tweet:
    name: Post to Twitter
    runs-on: ubuntu-latest
    timeout-minutes: 15
    needs: [archive-site]
    if: inputs.tweet == true
    steps:
      - id: checkout
        name: Checkout
        uses: actions/checkout@v3

      - id: install
        name: Install Python dependencies
        uses: ./.github/actions/install

      - uses: actions/download-artifact@v3
        with:
          name: screenshots
          path: ./_input

      - id: tweet
        name: Tweet
        run: pipenv run python -m newshomepages.tweet single ${{ inputs.handle }} -i ./_input/
        shell: bash
        env:
          TWITTER_CONSUMER_KEY: ${{ secrets.TWITTER_CONSUMER_KEY }}
          TWITTER_CONSUMER_SECRET: ${{ secrets.TWITTER_CONSUMER_SECRET }}
          TWITTER_ACCESS_TOKEN_KEY: ${{ secrets.TWITTER_ACCESS_TOKEN_KEY }}
          TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
